<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>-Dice Battlefield System-</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap");

      * {
        font-family: "Noto Sans KR", sans-serif;
      }

      body {
        padding: 20px;
        background-color: black;
        color: aliceblue;
        background-color: #0c0e14;
        background-size: cover;
        background-position: center;
      }

      input {
        margin-bottom: 10px;
        padding: 5px;
        font-size: 11px;
      }

      button {
        padding: 10px 20px;
        font-size: 11px;
        margin-right: 10px;
      }

      .result {
        margin-top: 20px;
        font-weight: bold;
        white-space: pre-line;
        text-align: center;
        font-size: 11px;
      }

      .maintitle {
        background-position: top;
        background-size: cover;
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 15px;
        color: aliceblue;
        background-color: rgba(0, 0, 0, 0.6);
        height: 100px;
        width: 550px;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        margin: 20px auto;
      }

      .character {
        width: 550px;
        margin: 10px auto;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 10px;
        background-color: #0c0e14;
      }

      .character .form-label {
        font-weight: bold;
      }

      .btn-group {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        gap: 10px;
      }
    </style>
  </head>

  <body>
    <h2 class="maintitle">ë°°í‹€ ì´ë²¤íŠ¸</h2>
    <div class="character">
      <div class="row mb-3">
        <div class="col">
          <label for="char1" class="form-label">ì„ ê³µ</label>
          <input
            type="text"
            class="form-control"
            id="char1"
            placeholder="ì˜ˆ: ì œì¸ ë„"
          />
        </div>
        <div class="col">
          <label for="char2" class="form-label">í›„ê³µ</label>
          <input
            type="text"
            class="form-control"
            id="char2"
            placeholder="ì˜ˆ: ì¡´ ë„"
          />
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="startHP" class="form-label">ì´ˆê¸° ì²´ë ¥</label>
          <input
            type="number"
            class="form-control"
            id="startHP"
            placeholder="ì˜ˆ: 15"
            min="1"
          />
        </div>
        <div class="col">
          <label for="maxTurn" class="form-label">í„´ ìˆ˜</label>
          <input
            type="number"
            class="form-control"
            id="maxTurn"
            placeholder="ì˜ˆ: 3"
            min="1"
          />
        </div>
      </div>

      <!-- ì‹¤ì‹œê°„ ì²´ë ¥ ê²Œì´ì§€ë°” -->
      <div class="mt-3">
        <label class="form-label" id="hp1NameLabel">ìºë¦­í„° 1</label>
        <div class="progress mb-2">
          <div
            id="hp1Bar"
            class="progress-bar bg-success"
            role="progressbar"
            style="width: 100%"
          >
            15 HP
          </div>
        </div>

        <label class="form-label" id="hp2NameLabel">ìºë¦­í„° 2</label>
        <div class="progress">
          <div
            id="hp2Bar"
            class="progress-bar bg-success"
            role="progressbar"
            style="width: 100%"
          >
            15 HP
          </div>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn btn-primary" onclick="initBattle()">
          ì „íˆ¬ ì‹œì‘
        </button>
        <button
          class="btn btn-secondary"
          onclick="nextTurn()"
          id="turnButton"
          disabled
        >
          ë‹¤ìŒ í„´
        </button>
      </div>

      <div class="result" id="resultArea"></div>
    </div>

    <script>
      let name1, name2;
      let hp1 = 15;
      let hp2 = 15;
      let turn = 1;
      let maxTurns = 3;
      let log = "";

      function initBattle() {
        name1 = document.getElementById("char1").value || "ìºë¦­í„° 1";
        name2 = document.getElementById("char2").value || "ìºë¦­í„° 2";

        const inputHP = parseInt(document.getElementById("startHP").value);
        const inputTurn = parseInt(document.getElementById("maxTurn").value);

        const startHP = isNaN(inputHP) ? 15 : inputHP;
        maxTurns = isNaN(inputTurn) ? 3 : inputTurn;

        hp1 = startHP;
        hp2 = startHP;
        turn = 1;
        log = `[ ì „íˆ¬ ì‹œì‘! ì´ˆê¸° ì²´ë ¥ ${startHP}, ì´ ${maxTurns}í„´ ì§„í–‰ ì˜ˆì • ]\n\n`;

        document.getElementById("resultArea").innerHTML = log;
        document.getElementById("turnButton").disabled = false;
        document.getElementById("hp1NameLabel").innerText = name1;
        document.getElementById("hp2NameLabel").innerText = name2;
        updateHpBar(); // ì²´ë ¥ë°” ì´ˆê¸° ì„¤ì •
      }

      function nextTurn() {
        if (turn > maxTurns || hp1 <= 0 || hp2 <= 0) return;

        const time = new Date().toLocaleTimeString();
        let roll1 = Math.floor(Math.random() * 6) + 1;
        let roll2 = Math.floor(Math.random() * 6) + 1;

        let logTurn = `<span style="font-size: 13px;">~ ì œ ${turn} í„´ ~</span>\n`;
        let dmg1 = roll1;
        let dmg2 = roll2;
        let effect1 = "";
        let effect2 = "";

        const rand1 = Math.random();
        if (rand1 < 0.05) {
          dmg1 = 0;
          effect1 = "(ë°©ì–´ ì„±ê³µ!)";
        } else if (rand1 < 0.1) {
          dmg1 = roll1 * 2;
          effect1 = "(ì¹˜ëª…íƒ€!)";
        }

        const rand2 = Math.random();
        if (rand2 < 0.05) {
          dmg2 = 0;
          effect2 = "(ë°©ì–´ ì„±ê³µ!)";
        } else if (rand2 < 0.1) {
          dmg2 = roll2 * 2;
          effect2 = "(ì¹˜ëª…íƒ€!)";
        }

        hp1 -= dmg2;
        hp2 -= dmg1;

        logTurn += `${name1}ì˜ ëŒ€ë¯¸ì§€: ${roll1} ${effect1}, ${name2}ì˜ ëŒ€ë¯¸ì§€: ${roll2} ${effect2}\n`;
        logTurn += `${name1}ì˜ ë‚¨ì€ HP: ${Math.max(
          hp1,
          0
        )}, ${name2}ì˜ ë‚¨ì€ HP: ${Math.max(hp2, 0)}\n`;

        if (hp1 > hp2) {
          logTurn += `<span style="color: gold;">â†’ ${name1} ìš°ì„¸!</span>\n`;
        } else if (hp2 > hp1) {
          logTurn += `<span style="color: gold;">â†’ ${name2} ìš°ì„¸!</span>\n`;
        } else {
          logTurn += `<span style="color: gold;">â†’ ë§‰ìƒë§‰í•˜! í˜„ì¬ ë¬´ìŠ¹ë¶€!</span>\n`;
        }

        if (hp1 <= 4 && hp1 > 0)
          logTurn += `<span style="color: red;">âš  ${name1} ìœ„ê¸°!</span>\n`;
        if (hp2 <= 4 && hp2 > 0)
          logTurn += `<span style="color: red;">âš  ${name2} ìœ„ê¸°!</span>\n`;

        logTurn += `<span style="font-size: 7pt;">(ê¸°ë¡ ì‹œê°„: ${time})</span>\n\n`;

        log += logTurn;
        document.getElementById("resultArea").innerHTML = log;

        if (hp1 <= 0 || hp2 <= 0 || turn === maxTurns) {
          showFinalResult();
          document.getElementById("turnButton").disabled = true;
        }

        updateHpBar();

        turn++;
      }

      function showFinalResult() {
        log += `<span style="font-size: 13px; color: gold; background-color: black;">ìµœì¢… ê²°ê³¼</span>\n`;
        if (hp1 <= 0 && hp2 <= 0) {
          log += `ë‘ ì‚¬ëŒ ëª¨ë‘ ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤. ë¬´ìŠ¹ë¶€!`;
        } else if (hp1 <= 0) {
          log += `${name1}ì˜ ì²´ë ¥ì´ 0 ì´í•˜ë¡œ ì“°ëŸ¬ì§€ê³  ë§™ë‹ˆë‹¤! ${name2}ì˜ ìŠ¹ë¦¬!`;
        } else if (hp2 <= 0) {
          log += `${name2}ì˜ ì²´ë ¥ì´ 0 ì´í•˜ë¡œ ì“°ëŸ¬ì§€ê³  ë§™ë‹ˆë‹¤! ${name1}ì˜ ìŠ¹ë¦¬!`;
        } else if (hp1 > hp2) {
          log += `ì•„ì§ ê±´ì¬í•œ ${name1}! ${name1}ì˜ ì²´ë ¥ì´ ë” ë§ì•„ ${name1}ì˜ ìŠ¹ë¦¬!`;
        } else if (hp2 > hp1) {
          log += `ì•„ì§ ê±´ì¬í•œ ${name2}! ${name2}ì˜ ì²´ë ¥ì´ ë” ë§ì•„ ${name2}ì˜ ìŠ¹ë¦¬!`;
        } else {
          log += `ë§‰ìƒë§‰í•˜ì˜ ìŠ¹ë¶€ë¡œêµ°ìš”! ë™ì¼í•œ ì”ì—¬ ì²´ë ¥ìœ¼ë¡œ ë¬´ìŠ¹ë¶€ì…ë‹ˆë‹¤!`;
        }

        document.getElementById("resultArea").innerHTML = log;
      }

      // ğŸ‘‡ ë§¨ ìœ„ë¡œ
      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
      // ğŸ‘‡ ë§¨ ì•„ë˜ë¡œ
      function scrollToBottom() {
        window.scrollTo({
          top: document.body.scrollHeight,
          behavior: "smooth",
        });
      }

      function updateHpBar() {
        const percent1 = Math.max(
          0,
          (hp1 / parseInt(document.getElementById("startHP").value || 15)) * 100
        );
        const percent2 = Math.max(
          0,
          (hp2 / parseInt(document.getElementById("startHP").value || 15)) * 100
        );

        const bar1 = document.getElementById("hp1Bar");
        const bar2 = document.getElementById("hp2Bar");

        // Bar 1
        bar1.style.width = `${percent1}%`;
        bar1.innerText = `${Math.max(hp1, 0)} HP`;
        bar1.classList.remove("bg-success", "bg-warning", "bg-danger");
        if (percent1 <= 20) {
          bar1.classList.add("bg-danger");
        } else if (percent1 <= 50) {
          bar1.classList.add("bg-warning");
        } else {
          bar1.classList.add("bg-success");
        }

        // Bar 2
        bar2.style.width = `${percent2}%`;
        bar2.innerText = `${Math.max(hp2, 0)} HP`;
        bar2.classList.remove("bg-success", "bg-warning", "bg-danger");
        if (percent2 <= 20) {
          bar2.classList.add("bg-danger");
        } else if (percent2 <= 50) {
          bar2.classList.add("bg-warning");
        } else {
          bar2.classList.add("bg-success");
        }
      }
    </script>
    <!-- ë§¨ ìœ„ë¡œ ì´ë™ ë²„íŠ¼ -->
    <button
      onclick="scrollToTop()"
      style="
        position: fixed;
        bottom: 70px;
        right: 20px;
        background-color: #23395d;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 18px;
        cursor: pointer;
        z-index: 999;
        display: flex;
        align-items: center;
        justify-content: center;
      "
      title="ë§¨ ìœ„ë¡œ"
    >
      â–³
    </button>

    <!-- ë§¨ ì•„ë˜ë¡œ ì´ë™ ë²„íŠ¼ -->
    <button
      onclick="scrollToBottom()"
      style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #23395d;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 18px;
        cursor: pointer;
        z-index: 999;
        display: flex;
        align-items: center;
        justify-content: center;
      "
      title="ë§¨ ì•„ë˜ë¡œ"
    >
      â–½
    </button>
  </body>
</html>
