<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>-Dice Battlefield System-</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap");

      * {
        font-family: "Noto Sans KR", sans-serif;
      }

      body {
        padding: 20px;
        background-color: black;
        color: aliceblue;
        background-color: #0c0e14;
        background-size: cover;
        background-position: center;
      }

      input {
        margin-bottom: 10px;
        padding: 5px;
        font-size: 11px;
      }

      button {
        padding: 10px 20px;
        font-size: 11px;
        margin-right: 10px;
      }

      .result {
        margin-top: 20px;
        font-weight: bold;
        white-space: pre-line;
        text-align: center;
        font-size: 11px;
      }

      .maintitle {
        background-position: top;
        background-size: cover;
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 15px;
        color: aliceblue;
        background-color: rgba(0, 0, 0, 0.6);
        height: 100px;
        width: 550px;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        margin: 20px auto;
      }

      .character {
        width: 550px;
        margin: 10px auto;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 10px;
        background-color: #0c0e14;
      }

      .character .form-label {
        font-weight: bold;
      }

      .btn-group {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        gap: 10px;
      }
    </style>
  </head>

  <body>
    <h2 class="maintitle">배틀 이벤트</h2>
    <div class="character">
      <div class="row mb-3">
        <div class="col">
          <label for="char1" class="form-label">선공</label>
          <input
            type="text"
            class="form-control"
            id="char1"
            placeholder="예: 제인 도"
          />
        </div>
        <div class="col">
          <label for="char2" class="form-label">후공</label>
          <input
            type="text"
            class="form-control"
            id="char2"
            placeholder="예: 존 도"
          />
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="startHP" class="form-label">초기 체력</label>
          <input
            type="number"
            class="form-control"
            id="startHP"
            placeholder="예: 15"
            min="1"
          />
        </div>
        <div class="col">
          <label for="maxTurn" class="form-label">턴 수</label>
          <input
            type="number"
            class="form-control"
            id="maxTurn"
            placeholder="예: 3"
            min="1"
          />
        </div>
      </div>

      <!-- 실시간 체력 게이지바 -->
      <div class="mt-3">
        <label class="form-label" id="hp1NameLabel">캐릭터 1</label>
        <div class="progress mb-2">
          <div
            id="hp1Bar"
            class="progress-bar bg-success"
            role="progressbar"
            style="width: 100%"
          >
            15 HP
          </div>
        </div>

        <label class="form-label" id="hp2NameLabel">캐릭터 2</label>
        <div class="progress">
          <div
            id="hp2Bar"
            class="progress-bar bg-success"
            role="progressbar"
            style="width: 100%"
          >
            15 HP
          </div>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn btn-primary" onclick="initBattle()">
          전투 시작
        </button>
        <button
          class="btn btn-secondary"
          onclick="nextTurn()"
          id="turnButton"
          disabled
        >
          다음 턴
        </button>
      </div>

      <div class="result" id="resultArea"></div>
    </div>

    <script>
      let name1, name2;
      let hp1 = 15;
      let hp2 = 15;
      let turn = 1;
      let maxTurns = 3;
      let log = "";

      function initBattle() {
        name1 = document.getElementById("char1").value || "캐릭터 1";
        name2 = document.getElementById("char2").value || "캐릭터 2";

        const inputHP = parseInt(document.getElementById("startHP").value);
        const inputTurn = parseInt(document.getElementById("maxTurn").value);

        const startHP = isNaN(inputHP) ? 15 : inputHP;
        maxTurns = isNaN(inputTurn) ? 3 : inputTurn;

        hp1 = startHP;
        hp2 = startHP;
        turn = 1;
        log = `[ 전투 시작! 초기 체력 ${startHP}, 총 ${maxTurns}턴 진행 예정 ]\n\n`;

        document.getElementById("resultArea").innerHTML = log;
        document.getElementById("turnButton").disabled = false;
        document.getElementById("hp1NameLabel").innerText = name1;
        document.getElementById("hp2NameLabel").innerText = name2;
        updateHpBar(); // 체력바 초기 설정
      }

      function nextTurn() {
        if (turn > maxTurns || hp1 <= 0 || hp2 <= 0) return;

        const time = new Date().toLocaleTimeString();
        let roll1 = Math.floor(Math.random() * 6) + 1;
        let roll2 = Math.floor(Math.random() * 6) + 1;

        let logTurn = `<span style="font-size: 13px;">~ 제 ${turn} 턴 ~</span>\n`;
        let dmg1 = roll1;
        let dmg2 = roll2;
        let effect1 = "";
        let effect2 = "";

        const rand1 = Math.random();
        if (rand1 < 0.05) {
          dmg1 = 0;
          effect1 = "(방어 성공!)";
        } else if (rand1 < 0.1) {
          dmg1 = roll1 * 2;
          effect1 = "(치명타!)";
        }

        const rand2 = Math.random();
        if (rand2 < 0.05) {
          dmg2 = 0;
          effect2 = "(방어 성공!)";
        } else if (rand2 < 0.1) {
          dmg2 = roll2 * 2;
          effect2 = "(치명타!)";
        }

        hp1 -= dmg2;
        hp2 -= dmg1;

        logTurn += `${name1}의 대미지: ${roll1} ${effect1}, ${name2}의 대미지: ${roll2} ${effect2}\n`;
        logTurn += `${name1}의 남은 HP: ${Math.max(
          hp1,
          0
        )}, ${name2}의 남은 HP: ${Math.max(hp2, 0)}\n`;

        if (hp1 > hp2) {
          logTurn += `<span style="color: gold;">→ ${name1} 우세!</span>\n`;
        } else if (hp2 > hp1) {
          logTurn += `<span style="color: gold;">→ ${name2} 우세!</span>\n`;
        } else {
          logTurn += `<span style="color: gold;">→ 막상막하! 현재 무승부!</span>\n`;
        }

        if (hp1 <= 4 && hp1 > 0)
          logTurn += `<span style="color: red;">⚠ ${name1} 위기!</span>\n`;
        if (hp2 <= 4 && hp2 > 0)
          logTurn += `<span style="color: red;">⚠ ${name2} 위기!</span>\n`;

        logTurn += `<span style="font-size: 7pt;">(기록 시간: ${time})</span>\n\n`;

        log += logTurn;
        document.getElementById("resultArea").innerHTML = log;

        if (hp1 <= 0 || hp2 <= 0 || turn === maxTurns) {
          showFinalResult();
          document.getElementById("turnButton").disabled = true;
        }

        updateHpBar();

        turn++;
      }

      function showFinalResult() {
        log += `<span style="font-size: 13px; color: gold; background-color: black;">최종 결과</span>\n`;
        if (hp1 <= 0 && hp2 <= 0) {
          log += `두 사람 모두 쓰러졌습니다. 무승부!`;
        } else if (hp1 <= 0) {
          log += `${name1}의 체력이 0 이하로 쓰러지고 맙니다! ${name2}의 승리!`;
        } else if (hp2 <= 0) {
          log += `${name2}의 체력이 0 이하로 쓰러지고 맙니다! ${name1}의 승리!`;
        } else if (hp1 > hp2) {
          log += `아직 건재한 ${name1}! ${name1}의 체력이 더 많아 ${name1}의 승리!`;
        } else if (hp2 > hp1) {
          log += `아직 건재한 ${name2}! ${name2}의 체력이 더 많아 ${name2}의 승리!`;
        } else {
          log += `막상막하의 승부로군요! 동일한 잔여 체력으로 무승부입니다!`;
        }

        document.getElementById("resultArea").innerHTML = log;
      }

      // 👇 맨 위로
      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
      // 👇 맨 아래로
      function scrollToBottom() {
        window.scrollTo({
          top: document.body.scrollHeight,
          behavior: "smooth",
        });
      }

      function updateHpBar() {
        const percent1 = Math.max(
          0,
          (hp1 / parseInt(document.getElementById("startHP").value || 15)) * 100
        );
        const percent2 = Math.max(
          0,
          (hp2 / parseInt(document.getElementById("startHP").value || 15)) * 100
        );

        const bar1 = document.getElementById("hp1Bar");
        const bar2 = document.getElementById("hp2Bar");

        // Bar 1
        bar1.style.width = `${percent1}%`;
        bar1.innerText = `${Math.max(hp1, 0)} HP`;
        bar1.classList.remove("bg-success", "bg-warning", "bg-danger");
        if (percent1 <= 20) {
          bar1.classList.add("bg-danger");
        } else if (percent1 <= 50) {
          bar1.classList.add("bg-warning");
        } else {
          bar1.classList.add("bg-success");
        }

        // Bar 2
        bar2.style.width = `${percent2}%`;
        bar2.innerText = `${Math.max(hp2, 0)} HP`;
        bar2.classList.remove("bg-success", "bg-warning", "bg-danger");
        if (percent2 <= 20) {
          bar2.classList.add("bg-danger");
        } else if (percent2 <= 50) {
          bar2.classList.add("bg-warning");
        } else {
          bar2.classList.add("bg-success");
        }
      }
    </script>
    <!-- 맨 위로 이동 버튼 -->
    <button
      onclick="scrollToTop()"
      style="
        position: fixed;
        bottom: 70px;
        right: 20px;
        background-color: #23395d;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 18px;
        cursor: pointer;
        z-index: 999;
        display: flex;
        align-items: center;
        justify-content: center;
      "
      title="맨 위로"
    >
      △
    </button>

    <!-- 맨 아래로 이동 버튼 -->
    <button
      onclick="scrollToBottom()"
      style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #23395d;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 18px;
        cursor: pointer;
        z-index: 999;
        display: flex;
        align-items: center;
        justify-content: center;
      "
      title="맨 아래로"
    >
      ▽
    </button>
  </body>
</html>
